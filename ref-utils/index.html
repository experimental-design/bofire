
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://experimental-design.github.io/bofire/ref-utils/">
      
      
        <link rel="prev" href="../ref-features/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Utils - BoFire</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#utils" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BoFire" class="md-header__button md-logo" aria-label="BoFire" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BoFire
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Utils
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/experimental-design/bofire" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    experimental-design/bofire
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BoFire" class="md-nav__button md-logo" aria-label="BoFire" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    BoFire
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/experimental-design/bofire" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    experimental-design/bofire
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic terminology
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_models_functionals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Models vs Functional Components
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../userguide_surrogates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Surrogate Models
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ref-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ref-constraints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constraints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ref-objectives/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Objectives
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ref-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bofire.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bofire.utils.cheminformatics" class="md-nav__link">
    <span class="md-ellipsis">
      cheminformatics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cheminformatics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bofire.utils.cheminformatics.smiles2fingerprints" class="md-nav__link">
    <span class="md-ellipsis">
      smiles2fingerprints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.cheminformatics.smiles2fragments" class="md-nav__link">
    <span class="md-ellipsis">
      smiles2fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.cheminformatics.smiles2mol" class="md-nav__link">
    <span class="md-ellipsis">
      smiles2mol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.cheminformatics.smiles2mordred" class="md-nav__link">
    <span class="md-ellipsis">
      smiles2mordred
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bofire.utils.doe" class="md-nav__link">
    <span class="md-ellipsis">
      doe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="doe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.apply_block_generator" class="md-nav__link">
    <span class="md-ellipsis">
      apply_block_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.compute_generator" class="md-nav__link">
    <span class="md-ellipsis">
      compute_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.ff2n" class="md-nav__link">
    <span class="md-ellipsis">
      ff2n
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.fracfact" class="md-nav__link">
    <span class="md-ellipsis">
      fracfact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.get_alias_structure" class="md-nav__link">
    <span class="md-ellipsis">
      get_alias_structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.get_block_generator" class="md-nav__link">
    <span class="md-ellipsis">
      get_block_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.get_confounding_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      get_confounding_matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.get_default_generator" class="md-nav__link">
    <span class="md-ellipsis">
      get_default_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.get_generator" class="md-nav__link">
    <span class="md-ellipsis">
      get_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.get_n_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      get_n_blocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.doe.validate_generator" class="md-nav__link">
    <span class="md-ellipsis">
      validate_generator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bofire.utils.multiobjective" class="md-nav__link">
    <span class="md-ellipsis">
      multiobjective
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multiobjective">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bofire.utils.multiobjective.compute_hypervolume" class="md-nav__link">
    <span class="md-ellipsis">
      compute_hypervolume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.multiobjective.get_pareto_front" class="md-nav__link">
    <span class="md-ellipsis">
      get_pareto_front
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.multiobjective.get_ref_point_mask" class="md-nav__link">
    <span class="md-ellipsis">
      get_ref_point_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.multiobjective.infer_ref_point" class="md-nav__link">
    <span class="md-ellipsis">
      infer_ref_point
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bofire.utils.naming_conventions" class="md-nav__link">
    <span class="md-ellipsis">
      naming_conventions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="naming_conventions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bofire.utils.naming_conventions.get_column_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_column_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.naming_conventions.postprocess_categorical_predictions" class="md-nav__link">
    <span class="md-ellipsis">
      postprocess_categorical_predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bofire.utils.reduce" class="md-nav__link">
    <span class="md-ellipsis">
      reduce
    </span>
  </a>
  
    <nav class="md-nav" aria-label="reduce">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.AffineTransform" class="md-nav__link">
    <span class="md-ellipsis">
      AffineTransform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AffineTransform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.AffineTransform.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.AffineTransform.augment_data" class="md-nav__link">
    <span class="md-ellipsis">
      augment_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.AffineTransform.drop_data" class="md-nav__link">
    <span class="md-ellipsis">
      drop_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.adjust_boundary" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_boundary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.check_domain_for_reduction" class="md-nav__link">
    <span class="md-ellipsis">
      check_domain_for_reduction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.check_existence_of_solution" class="md-nav__link">
    <span class="md-ellipsis">
      check_existence_of_solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.reduce_domain" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.remove_eliminated_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      remove_eliminated_inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.reduce.rref" class="md-nav__link">
    <span class="md-ellipsis">
      rref
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bofire.utils.subdomain" class="md-nav__link">
    <span class="md-ellipsis">
      subdomain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="subdomain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bofire.utils.subdomain.get_subdomain" class="md-nav__link">
    <span class="md-ellipsis">
      get_subdomain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools" class="md-nav__link">
    <span class="md-ellipsis">
      torch_tools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="torch_tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.InterpolateTransform" class="md-nav__link">
    <span class="md-ellipsis">
      InterpolateTransform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.constrained_objective2botorch" class="md-nav__link">
    <span class="md-ellipsis">
      constrained_objective2botorch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_initial_conditions_generator" class="md-nav__link">
    <span class="md-ellipsis">
      get_initial_conditions_generator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_interpoint_constraints" class="md-nav__link">
    <span class="md-ellipsis">
      get_interpoint_constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_linear_constraints" class="md-nav__link">
    <span class="md-ellipsis">
      get_linear_constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_multiobjective_objective" class="md-nav__link">
    <span class="md-ellipsis">
      get_multiobjective_objective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_multiplicative_additive_objective" class="md-nav__link">
    <span class="md-ellipsis">
      get_multiplicative_additive_objective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_nchoosek_constraints" class="md-nav__link">
    <span class="md-ellipsis">
      get_nchoosek_constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_nonlinear_constraints" class="md-nav__link">
    <span class="md-ellipsis">
      get_nonlinear_constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_output_constraints" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.get_product_constraints" class="md-nav__link">
    <span class="md-ellipsis">
      get_product_constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bofire.utils.torch_tools.interp1d" class="md-nav__link">
    <span class="md-ellipsis">
      interp1d
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="utils">Utils</h1>


<div class="doc doc-object doc-module">



<a id="bofire.utils"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="bofire.utils.cheminformatics" class="doc doc-heading">
            <code>cheminformatics</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="bofire.utils.cheminformatics.smiles2fingerprints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smiles2fingerprints</span><span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="n">bond_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_bits</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transforms a list of smiles to an array of morgan fingerprints.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>smiles</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of smiles</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bond_radius</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bond radius to use. Defaults to 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bits</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bits. Defaults to 2048.</p>
              </div>
            </td>
            <td>
                  <code>2048</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Numpy array holding the fingerprints</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/cheminformatics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">smiles2fingerprints</span><span class="p">(</span>
    <span class="n">smiles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">bond_radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">n_bits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms a list of smiles to an array of morgan fingerprints.</span>

<span class="sd">    Args:</span>
<span class="sd">        smiles (List[str]): List of smiles</span>
<span class="sd">        bond_radius (int, optional): Bond radius to use. Defaults to 5.</span>
<span class="sd">        n_bits (int, optional): Number of bits. Defaults to 2048.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Numpy array holding the fingerprints</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rdkit_mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">smiles2mol</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">smiles</span><span class="p">]</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprintAsBitVect</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">bond_radius</span><span class="p">,</span> <span class="n">nBits</span><span class="o">=</span><span class="n">n_bits</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">rdkit_mols</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.cheminformatics.smiles2fragments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smiles2fragments</span><span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="n">fragments_list</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transforms smiles to an array of fragments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>smiles</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of smiles</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fragments_list</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of desired fragments. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Array holding the fragment information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/cheminformatics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">smiles2fragments</span><span class="p">(</span>
    <span class="n">smiles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">fragments_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms smiles to an array of fragments.</span>

<span class="sd">    Args:</span>
<span class="sd">        smiles (list[str]): List of smiles</span>
<span class="sd">        fragments_list (list[str], optional): List of desired fragments. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Array holding the fragment information.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rdkit_fragment_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">item</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Descriptors</span><span class="o">.</span><span class="n">descList</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fr_&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">fragments_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fragments</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">rdkit_fragment_list</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fragments</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">rdkit_fragment_list</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">fragments_list</span><span class="p">}</span>

    <span class="n">frags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">smiles</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fragments</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">smi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">smiles</span><span class="p">):</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">smiles2mol</span><span class="p">(</span><span class="n">smi</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">fragments</span><span class="p">[</span><span class="n">d</span><span class="p">](</span><span class="n">mol</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">fragments</span><span class="p">]</span>
        <span class="n">frags</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">features</span>

    <span class="k">return</span> <span class="n">frags</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.cheminformatics.smiles2mol" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smiles2mol</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transforms a smiles string to an rdkit mol object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>smiles</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Smiles string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If string is not a valid smiles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>rdkit.Mol: rdkit.mol object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/cheminformatics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">smiles2mol</span><span class="p">(</span><span class="n">smiles</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms a smiles string to an rdkit mol object.</span>

<span class="sd">    Args:</span>
<span class="sd">        smiles (str): Smiles string.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If string is not a valid smiles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rdkit.Mol: rdkit.mol object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">smiles</span><span class="si">}</span><span class="s2"> is not a valid smiles string.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mol</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.cheminformatics.smiles2mordred" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smiles2mordred</span><span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="n">descriptors_list</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transforms list of smiles to mordred moelcular descriptors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>smiles</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of smiles</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>descriptors_list</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of desired mordred descriptors</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Array holding the mordred moelcular descriptors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/cheminformatics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">smiles2mordred</span><span class="p">(</span><span class="n">smiles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">descriptors_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms list of smiles to mordred moelcular descriptors.</span>

<span class="sd">    Args:</span>
<span class="sd">        smiles (List[str]): List of smiles</span>
<span class="sd">        descriptors_list (List[str]): List of desired mordred descriptors</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Array holding the mordred moelcular descriptors.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">smiles2mol</span><span class="p">(</span><span class="n">smi</span><span class="p">)</span> <span class="k">for</span> <span class="n">smi</span> <span class="ow">in</span> <span class="n">smiles</span><span class="p">]</span>

    <span class="n">calc</span> <span class="o">=</span> <span class="n">Calculator</span><span class="p">(</span><span class="n">descriptors</span><span class="p">,</span> <span class="n">ignore_3D</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">calc</span><span class="o">.</span><span class="n">descriptors</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">calc</span><span class="o">.</span><span class="n">descriptors</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">descriptors_list</span><span class="p">]</span>

    <span class="n">descriptors_df</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">pandas</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>
    <span class="n">nan_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">descriptors_df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">descriptors_df</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">nan_list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Found NaN values in descriptors </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">descriptors_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">nan_list</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">descriptors_df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="bofire.utils.doe" class="doc doc-heading">
            <code>doe</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.apply_block_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_block_generator</span><span class="p">(</span><span class="n">design</span><span class="p">,</span> <span class="n">gen</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Applies blocking to a design matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>design</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The design matrix.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gen</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generator.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of integers which assigns an experiment in the design matrix to a block.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_block_generator</span><span class="p">(</span><span class="n">design</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">gen</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies blocking to a design matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        design: The design matrix.</span>
<span class="sd">        gen: The generator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of integers which assigns an experiment in the design matrix to a block.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gen</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)]</span>

    <span class="c1"># Fill in design with two level factorial design</span>
    <span class="n">blocking_design</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">design</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">generators</span><span class="p">)))</span>

    <span class="c1"># Recognize combinations and fill in the rest of matrix H2 with the proper</span>
    <span class="c1"># products</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">generators</span><span class="p">):</span>
        <span class="c1"># For lowercase letters</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">g</span><span class="p">])</span> <span class="o">-</span> <span class="mi">97</span>
        <span class="n">blocking_design</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">design</span><span class="p">[:,</span> <span class="n">xx</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Create a list to store the block assignments</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Iterate over each row in the design matrix</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">blocking_design</span><span class="p">:</span>
        <span class="c1"># Find the index of the unique row in the blocking design</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">blocking_design</span> <span class="o">==</span> <span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">blocks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.compute_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes a generator for a given number of factors and generators.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_factors</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of factors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_generators</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of generators.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generator.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes a generator for a given number of factors and generators.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_factors: The number of factors.</span>
<span class="sd">        n_generators: The number of generators.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The generator.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_generators</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="n">n_factors</span><span class="p">]))</span>
    <span class="n">n_base_factors</span> <span class="o">=</span> <span class="n">n_factors</span> <span class="o">-</span> <span class="n">n_generators</span>
    <span class="k">if</span> <span class="n">n_generators</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n_base_factors</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Design not possible, as main factors are confounded with each other.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="n">n_base_factors</span><span class="p">])</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="n">n_base_factors</span><span class="p">]],</span>
        <span class="p">)</span>
    <span class="n">n_base_factors</span> <span class="o">=</span> <span class="n">n_factors</span> <span class="o">-</span> <span class="n">n_generators</span>
    <span class="k">if</span> <span class="n">n_base_factors</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Design not possible, as main factors are confounded with each other.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span>
                <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="n">n_base_factors</span><span class="p">],</span>
                <span class="n">n_base_factors</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n_generators</span><span class="p">:</span>
        <span class="n">generators</span> <span class="o">=</span> <span class="n">generators</span><span class="p">[:</span><span class="n">n_generators</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">n_generators</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n_base_factors</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">generators</span> <span class="o">+=</span> <span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="n">n_base_factors</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">n_generators</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Design not possible, as main factors are confounded with each other.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="n">n_base_factors</span><span class="p">])</span> <span class="o">+</span> <span class="n">generators</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.ff2n" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ff2n</span><span class="p">(</span><span class="n">n_factors</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the full factorial design for a given number of factors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_factors</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of factors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The full factorial design.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ff2n</span><span class="p">(</span><span class="n">n_factors</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the full factorial design for a given number of factors.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_factors: The number of factors.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The full factorial design.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="n">n_factors</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.fracfact" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fracfact</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the fractional factorial design for a given generator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gen</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generator.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fractional factorial design.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fracfact</span><span class="p">(</span><span class="n">gen</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the fractional factorial design for a given generator.</span>

<span class="sd">    Args:</span>
<span class="sd">        gen: The generator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The fractional factorial design.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">validate_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="o">=</span><span class="n">gen</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">)</span>

    <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\-|\s|\+&quot;</span><span class="p">,</span> <span class="n">gen</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="p">]</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">]</span>

    <span class="c1"># Indices of single letters (main factors)</span>
    <span class="n">idx_main</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Indices of letter combinations.</span>
    <span class="n">idx_combi</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Check if there are &quot;-&quot; operators in gen</span>
    <span class="n">idx_negative</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span>
    <span class="p">]</span>  <span class="c1"># remove empty strings</span>

    <span class="c1"># Fill in design with two level factorial design</span>
    <span class="n">H1</span> <span class="o">=</span> <span class="n">ff2n</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_main</span><span class="p">))</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">H1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)))</span>
    <span class="n">H</span><span class="p">[:,</span> <span class="n">idx_main</span><span class="p">]</span> <span class="o">=</span> <span class="n">H1</span>

    <span class="c1"># Recognize combinations and fill in the rest of matrix H2 with the proper</span>
    <span class="c1"># products</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">idx_combi</span><span class="p">:</span>
        <span class="c1"># For lowercase letters</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="o">-</span> <span class="mi">97</span>

        <span class="n">H</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">H1</span><span class="p">[:,</span> <span class="n">xx</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Update design if gen includes &quot;-&quot; operator</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_negative</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">H</span><span class="p">[:,</span> <span class="n">idx_negative</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Return the fractional factorial design</span>
    <span class="k">return</span> <span class="n">H</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.get_alias_structure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_alias_structure</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the alias structure of the design matrix. Works only for generators
with positive signs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gen</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generator.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The order up to which the alias structure should be calculated. Defaults to 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The alias structure of the design matrix.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_alias_structure</span><span class="p">(</span><span class="n">gen</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the alias structure of the design matrix. Works only for generators</span>
<span class="sd">    with positive signs.</span>

<span class="sd">    Args:</span>
<span class="sd">        gen: The generator.</span>
<span class="sd">        order: The order up to which the alias structure should be calculated. Defaults to 4.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The alias structure of the design matrix.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">design</span> <span class="o">=</span> <span class="n">fracfact</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>

    <span class="n">n_experiments</span><span class="p">,</span> <span class="n">n_factors</span> <span class="o">=</span> <span class="n">design</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">all_names</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="s2">&quot;I&quot;</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_factors</span><span class="p">)</span>
    <span class="n">all_combinations</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
        <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span><span class="n">n_experiments</span> <span class="o">*</span> <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">26</span><span class="p">,)]}</span>  <span class="c1"># 26 is mapped to I</span>

    <span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="n">all_combinations</span><span class="p">:</span>
        <span class="c1"># positive sign</span>
        <span class="n">contrast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span>
            <span class="n">design</span><span class="p">[:,</span> <span class="n">combination</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># this is the product of the combination</span>
        <span class="n">scontrast</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">contrast</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">aliases</span><span class="p">[</span><span class="n">scontrast</span><span class="p">]</span> <span class="o">=</span> <span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scontrast</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">aliases</span><span class="p">[</span><span class="n">scontrast</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combination</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="n">aliases_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">aliases_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="p">)),</span>
        <span class="p">)</span>  <span class="c1"># sort by length and then by the combination</span>
    <span class="n">aliases_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">aliases_list</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="nb">list</span><span class="p">:</span> <span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">],</span> <span class="nb">list</span><span class="p">),</span>
    <span class="p">)</span>  <span class="c1"># sort by the length of the alias</span>

    <span class="n">aliases_readable</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">aliases_list</span><span class="p">:</span>
        <span class="n">aliases_readable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot; = &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">all_names</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alias</span><span class="p">]),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">aliases_readable</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.get_block_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_block_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">,</span> <span class="n">n_blocks</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the block generator for a given number of factors, generators, repetitions, and blocks.</p>
<p>Should be only used if blocking cannot be reached by repetitions only.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_factors</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of factors</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_generators</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of generators/reducing factors</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_repetitions</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of repetitions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_blocks</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of blocks that should be realized</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If blocking can be reached by repetitions only.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The blocking generator.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_block_generator</span><span class="p">(</span>
    <span class="n">n_factors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_blocks</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the block generator for a given number of factors, generators, repetitions, and blocks.</span>

<span class="sd">    Should be only used if blocking cannot be reached by repetitions only.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_factors: number of factors</span>
<span class="sd">        n_generators: number of generators/reducing factors</span>
<span class="sd">        n_repetitions: number of repetitions</span>
<span class="sd">        n_blocks: number of blocks that should be realized</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If blocking can be reached by repetitions only.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The blocking generator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_repetitions</span> <span class="o">%</span> <span class="n">n_blocks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Blocking can be reached by repetitions only.&quot;</span><span class="p">)</span>

    <span class="n">possible_blocks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span>
            <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">==</span> <span class="n">n_factors</span>
            <span class="p">]</span><span class="o">.</span><span class="n">n_blocks</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">n_blocks</span> <span class="ow">in</span> <span class="n">possible_blocks</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">==</span> <span class="n">n_factors</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">n_blocks</span> <span class="o">==</span> <span class="n">n_blocks</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">block_generator</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">possible_blocks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">*</span> <span class="n">n_repetitions</span> <span class="o">%</span> <span class="n">n_blocks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">==</span> <span class="n">n_factors</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">n_blocks</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">block_generator</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No block generator available for the requested combination.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.get_confounding_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_confounding_matrix</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">design</span><span class="p">,</span> <span class="n">powers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Analyzes the confounding of a design and returns the confounding matrix.</p>
<p>Only takes continuous features into account.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Inputs (bofire.data_models.domain.api.Inputs)" href="../ref-domain/#bofire.data_models.domain.features.Inputs">Inputs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>design</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Design matrix.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>powers</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of powers of the individual factors/features that should be considered.
Integers has to be larger than 1. Defaults to [].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interactions</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List with interaction levels to be considered.
Integers has to be larger than 1. Defaults to [2].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>_type_</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_confounding_matrix</span><span class="p">(</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span><span class="p">,</span>
    <span class="n">design</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">powers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">interactions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyzes the confounding of a design and returns the confounding matrix.</span>

<span class="sd">    Only takes continuous features into account.</span>

<span class="sd">    Args:</span>
<span class="sd">        inputs (Inputs): Input features.</span>
<span class="sd">        design (pd.DataFrame): Design matrix.</span>
<span class="sd">        powers (List[int], optional): List of powers of the individual factors/features that should be considered.</span>
<span class="sd">            Integers has to be larger than 1. Defaults to [].</span>
<span class="sd">        interactions (List[int], optional): List with interaction levels to be considered.</span>
<span class="sd">            Integers has to be larger than 1. Defaults to [2].</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">MinMaxScaler</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CategoricalInput</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Categorical input features will be ignored.&quot;</span><span class="p">)</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">)</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">scaled_design</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">design</span><span class="p">[</span><span class="n">keys</span><span class="p">]),</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># add powers</span>
    <span class="k">if</span> <span class="n">powers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">powers</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Power has to be at least of degree two.&quot;</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">scaled_design</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">**</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_design</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">**</span> <span class="n">p</span>

    <span class="c1"># add interactions</span>
    <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">interactions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interactions</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Interaction has to be at least of degree two.&quot;</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Interaction has to be smaller than </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">for</span> <span class="n">combi</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="n">scaled_design</span><span class="p">[</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">scaled_design</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">combi</span><span class="p">)]</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scaled_design</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.get_default_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_default_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the default generator for a given number of factors and generators.</p>
<p>In case the combination is not available, the function will raise an error.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_factors</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of factors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_generators</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of generators.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generator.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_default_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the default generator for a given number of factors and generators.</span>

<span class="sd">    In case the combination is not available, the function will raise an error.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_factors: The number of factors.</span>
<span class="sd">        n_generators: The number of generators.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The generator.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_generators</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="n">n_factors</span><span class="p">]))</span>
    <span class="n">df_generators</span> <span class="o">=</span> <span class="n">default_fracfac_generators</span>
    <span class="n">n_base_factors</span> <span class="o">=</span> <span class="n">n_factors</span> <span class="o">-</span> <span class="n">n_generators</span>
    <span class="k">if</span> <span class="n">df_generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">df_generators</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">==</span> <span class="n">n_factors</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_generators</span><span class="o">.</span><span class="n">n_generators</span> <span class="o">==</span> <span class="n">n_generators</span><span class="p">)</span>
    <span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No generator available for the requested combination.&quot;</span><span class="p">)</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df_generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df_generators</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">==</span> <span class="n">n_factors</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_generators</span><span class="o">.</span><span class="n">n_generators</span> <span class="o">==</span> <span class="n">n_generators</span><span class="p">),</span>
            <span class="s2">&quot;generator&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_generators</span><span class="p">,</span> <span class="s2">&quot;Number of generators does not match.&quot;</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span><span class="n">generator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="n">n_base_factors</span><span class="p">])</span> <span class="o">+</span> <span class="n">generators</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.get_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a generator for a given number of factors and generators.</p>
<p>If the requested combination is available in the default generators, it will return
this one. Otherwise, it will compute a new one using <code>get_bofire_generator</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_factors</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of factors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_generators</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of generators.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generator.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a generator for a given number of factors and generators.</span>

<span class="sd">    If the requested combination is available in the default generators, it will return</span>
<span class="sd">    this one. Otherwise, it will compute a new one using `get_bofire_generator`.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_factors: The number of factors.</span>
<span class="sd">        n_generators: The number of generators.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The generator.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_default_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">compute_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.get_n_blocks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_n_blocks</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the number of possible blocks for a given number of factors, generators, and repetitions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_factors</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of factors</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_generators</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of generators/reducing factors</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_repetitions</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of repetitions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[int]: List of possible number of blocks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_n_blocks</span><span class="p">(</span><span class="n">n_factors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_generators</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the number of possible blocks for a given number of factors, generators, and repetitions.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_factors: number of factors</span>
<span class="sd">        n_generators: number of generators/reducing factors</span>
<span class="sd">        n_repetitions: number of repetitions</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[int]: List of possible number of blocks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_blocks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># check if no repetitions are planned</span>
    <span class="k">if</span> <span class="n">n_repetitions</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">==</span> <span class="n">n_factors</span>
                <span class="p">]</span><span class="o">.</span><span class="n">n_blocks</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check if blocking can be reached just by repetitions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_repetitions</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n_repetitions</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">n_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># check if blocking can be reached by a combination of explicit blocks and repetitions</span>
        <span class="n">n_blocks</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">==</span> <span class="n">n_factors</span><span class="p">,</span> <span class="s2">&quot;n_blocks&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">n_repetitions</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">default_blocking_generators</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">==</span> <span class="n">n_factors</span><span class="p">,</span> <span class="s2">&quot;n_blocks&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.doe.validate_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">,</span> <span class="n">generator</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validates the generator and thows an error if it is not valid.</p>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/doe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_generator</span><span class="p">(</span><span class="n">n_factors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates the generator and thows an error if it is not valid.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="n">n_factors</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Generator does not match the number of factors.&quot;</span><span class="p">)</span>
    <span class="c1"># clean it and transform it into a list</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\-|\s|\+&quot;</span><span class="p">,</span> <span class="n">generator</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="p">]</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">]</span>

    <span class="c1"># Indices of single letters (main factors)</span>
    <span class="n">idx_main</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_main</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one unconfounded main factor is needed.&quot;</span><span class="p">)</span>

    <span class="c1"># Check that single letters (main factors) are unique</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_main</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">({</span><span class="n">generators</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_main</span><span class="p">}):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Main factors are confounded with each other.&quot;</span><span class="p">)</span>

    <span class="c1"># Check that single letters (main factors) follow the alphabet</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">generators</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_main</span><span class="p">]))</span>
        <span class="o">!=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_main</span><span class="p">)]</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Use the letters `</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">idx_main</span><span class="p">)])</span><span class="si">}</span><span class="s2">` for the main factors.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Indices of letter combinations.</span>
    <span class="n">idx_combi</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># check that main factors come before combinations</span>
    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx_combi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">idx_main</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Main factors have to come before combinations.&quot;</span><span class="p">)</span>

    <span class="c1"># Check that letter combinations are unique</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_combi</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">({</span><span class="n">generators</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_combi</span><span class="p">}):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Generators are not unique.&quot;</span><span class="p">)</span>

    <span class="c1"># Check that only letters are used in the combinations that are also single letters (main factors)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="n">generators</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_main</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="n">generators</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_combi</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Generators are not valid.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">generator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="bofire.utils.multiobjective" class="doc doc-heading">
            <code>multiobjective</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="bofire.utils.multiobjective.compute_hypervolume" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_hypervolume</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">optimal_experiments</span><span class="p">,</span> <span class="n">ref_point</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method to compute the hypervolume for a given domain and pareto optimal experiments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain for which the hypervolume should be computed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimal_experiments</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pareto optimal experiments for which the hypervolume
should be computed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ref_point</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unmasked reference point for the hypervolume computation.
Masking is happening inside the method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hypervolume for the given domain and pareto optimal experiments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/multiobjective.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_hypervolume</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
    <span class="n">optimal_experiments</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">ref_point</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to compute the hypervolume for a given domain and pareto optimal experiments.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain: Domain for which the hypervolume should be computed.</span>
<span class="sd">        optimal_experiments: Pareto optimal experiments for which the hypervolume</span>
<span class="sd">            should be computed.</span>
<span class="sd">        ref_point: Unmasked reference point for the hypervolume computation.</span>
<span class="sd">            Masking is happening inside the method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Hypervolume for the given domain and pareto optimal experiments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get_by_objective</span><span class="p">(</span>
        <span class="n">includes</span><span class="o">=</span><span class="p">[</span><span class="n">MaximizeObjective</span><span class="p">,</span> <span class="n">MinimizeObjective</span><span class="p">,</span> <span class="n">CloseToTargetObjective</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">objective</span> <span class="o">=</span> <span class="n">get_multiobjective_objective</span><span class="p">(</span>
        <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span>
        <span class="n">experiments</span><span class="o">=</span><span class="n">optimal_experiments</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ref_point_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">get_ref_point_mask</span><span class="p">(</span><span class="n">domain</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
    <span class="n">hv</span> <span class="o">=</span> <span class="n">Hypervolume</span><span class="p">(</span>
        <span class="n">ref_point</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">ref_point</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get_keys_by_objective</span><span class="p">(</span>
                    <span class="n">includes</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">MaximizeObjective</span><span class="p">,</span>
                        <span class="n">MinimizeObjective</span><span class="p">,</span>
                        <span class="n">CloseToTargetObjective</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">)</span>
            <span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">ref_point_mask</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">hv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span>
        <span class="n">objective</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span>
                <span class="n">optimal_experiments</span><span class="p">[</span>
                    <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get_keys_by_objective</span><span class="p">(</span>
                        <span class="n">includes</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">MaximizeObjective</span><span class="p">,</span>
                            <span class="n">MinimizeObjective</span><span class="p">,</span>
                            <span class="n">CloseToTargetObjective</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.multiobjective.get_pareto_front" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pareto_front</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">experiments</span><span class="p">,</span> <span class="n">output_feature_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method to compute the pareto optimal experiments for a given domain and
experiments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain for which the pareto front should be computed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>experiments</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Experiments for which the pareto front should be computed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_feature_keys</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="list">list</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key of output feature that should be considered
in the pareto front. If <code>None</code> is provided, all keys
belonging to output features with one of the following objectives will
be considered: <code>MaximizeObjective</code>, <code>MinimizeObjective</code>,
<code>CloseToTargetObjective</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with pareto optimal experiments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/multiobjective.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_pareto_front</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
    <span class="n">experiments</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">output_feature_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to compute the pareto optimal experiments for a given domain and</span>
<span class="sd">    experiments.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain: Domain for which the pareto front should be computed.</span>
<span class="sd">        experiments: Experiments for which the pareto front should be computed.</span>
<span class="sd">        output_feature_keys: Key of output feature that should be considered</span>
<span class="sd">            in the pareto front. If `None` is provided, all keys</span>
<span class="sd">            belonging to output features with one of the following objectives will</span>
<span class="sd">            be considered: `MaximizeObjective`, `MinimizeObjective`,</span>
<span class="sd">            `CloseToTargetObjective`. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with pareto optimal experiments.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_feature_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get_by_objective</span><span class="p">(</span>
            <span class="n">includes</span><span class="o">=</span><span class="p">[</span><span class="n">MaximizeObjective</span><span class="p">,</span> <span class="n">MinimizeObjective</span><span class="p">,</span> <span class="n">CloseToTargetObjective</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get_by_keys</span><span class="p">(</span><span class="n">output_feature_keys</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;At least two output features have to be provided.&quot;</span>
    <span class="n">output_feature_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">preprocess_experiments_all_valid_outputs</span><span class="p">(</span>
        <span class="n">experiments</span><span class="p">,</span>
        <span class="n">output_feature_keys</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">objective</span> <span class="o">=</span> <span class="n">get_multiobjective_objective</span><span class="p">(</span><span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">experiments</span><span class="o">=</span><span class="n">experiments</span><span class="p">)</span>
    <span class="n">pareto_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="n">is_non_dominated</span><span class="p">(</span>
            <span class="n">objective</span><span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">output_feature_keys</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pareto_mask</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.multiobjective.get_ref_point_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ref_point_mask</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">output_feature_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method to get a mask for the reference points taking into account if we
want to maximize or minimize an objective. In case it is maximize the value
in the mask is 1, in case we want to minimize it is -1.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain for which the mask should be generated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_feature_keys</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="list">list</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of output feature keys
that should be considered in the mask. If <code>None</code> is provided, all keys
belonging to output features with one of the following objectives will
be considered: <code>MaximizeObjective</code>, <code>MinimizeObjective</code>,
<code>CloseToTargetObjective</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of ones for maximization and array of negative ones for
minimization.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/multiobjective.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ref_point_mask</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
    <span class="n">output_feature_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to get a mask for the reference points taking into account if we</span>
<span class="sd">    want to maximize or minimize an objective. In case it is maximize the value</span>
<span class="sd">    in the mask is 1, in case we want to minimize it is -1.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain: Domain for which the mask should be generated.</span>
<span class="sd">        output_feature_keys: Name of output feature keys</span>
<span class="sd">            that should be considered in the mask. If `None` is provided, all keys</span>
<span class="sd">            belonging to output features with one of the following objectives will</span>
<span class="sd">            be considered: `MaximizeObjective`, `MinimizeObjective`,</span>
<span class="sd">            `CloseToTargetObjective`. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array of ones for maximization and array of negative ones for</span>
<span class="sd">            minimization.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_feature_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_feature_keys</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get_keys_by_objective</span><span class="p">(</span>
            <span class="n">includes</span><span class="o">=</span><span class="p">[</span><span class="n">MaximizeObjective</span><span class="p">,</span> <span class="n">MinimizeObjective</span><span class="p">,</span> <span class="n">CloseToTargetObjective</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_feature_keys</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least two output features have to be provided.&quot;</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">output_feature_keys</span><span class="p">:</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">objective</span><span class="p">,</span> <span class="n">MaximizeObjective</span><span class="p">):</span>
            <span class="n">mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">objective</span><span class="p">,</span> <span class="n">MinimizeObjective</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">feat</span><span class="o">.</span><span class="n">objective</span><span class="p">,</span>
            <span class="n">CloseToTargetObjective</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only `MaximizeObjective` and `MinimizeObjective` supported&quot;</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.multiobjective.infer_ref_point" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">infer_ref_point</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">experiments</span><span class="p">,</span> <span class="n">return_masked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reference_point</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method to infer the reference point for a given domain and experiments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain for which the reference point should be inferred.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>experiments</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Experiments for which the reference point should be inferred.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_masked</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the masked reference point is returned. If False,
the unmasked reference point is returned. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reference_point</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="bofire.data_models.strategies.predictives.mobo.ExplicitReferencePoint">ExplicitReferencePoint</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference point to be used. If None is provided, the
reference value is inferred by the worst values seen so far for
every objective. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/multiobjective.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">infer_ref_point</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
    <span class="n">experiments</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">return_masked</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">reference_point</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ExplicitReferencePoint</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to infer the reference point for a given domain and experiments.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain: Domain for which the reference point should be inferred.</span>
<span class="sd">        experiments: Experiments for which the reference point should be inferred.</span>
<span class="sd">        return_masked: If True, the masked reference point is returned. If False,</span>
<span class="sd">            the unmasked reference point is returned. Defaults to False.</span>
<span class="sd">        reference_point: Reference point to be used. If None is provided, the</span>
<span class="sd">            reference value is inferred by the worst values seen so far for</span>
<span class="sd">            every objective. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get_by_objective</span><span class="p">(</span>
        <span class="n">includes</span><span class="o">=</span><span class="p">[</span><span class="n">MaximizeObjective</span><span class="p">,</span> <span class="n">MinimizeObjective</span><span class="p">,</span> <span class="n">CloseToTargetObjective</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">reference_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reference_point</span> <span class="o">=</span> <span class="n">ExplicitReferencePoint</span><span class="p">(</span>
            <span class="n">values</span><span class="o">=</span><span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">AbsoluteMovingReferenceValue</span><span class="p">(</span><span class="n">orient_at_best</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="n">objective</span> <span class="o">=</span> <span class="n">get_multiobjective_objective</span><span class="p">(</span><span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">experiments</span><span class="o">=</span><span class="n">experiments</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">preprocess_experiments_all_valid_outputs</span><span class="p">(</span>
        <span class="n">experiments</span><span class="p">,</span>
        <span class="n">output_feature_keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">worst_values_array</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">objective</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">best_values_array</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">objective</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># In the ref_point_array want masked values, which means that</span>
    <span class="c1"># maximization is assumed for everything, this is because we use</span>
    <span class="c1"># botorch objective for getting the best and worst values</span>
    <span class="c1"># that are passed to the reference values. Botorch always assumes</span>
    <span class="c1"># maximization.</span>
    <span class="c1"># In case of FixedReferenceValue, the unmasked values are stored in the data model,</span>
    <span class="c1"># this means the need to mask them to account for the botorch convention.</span>
    <span class="c1"># In case of FixedReferenceValue, we multiply with -1 in for `MinimizeObjective`</span>
    <span class="c1"># and `CloseToTargetObjective`.</span>
    <span class="n">ref_point_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="o">-</span><span class="n">reference_point</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_reference_value</span><span class="p">(</span>
                <span class="n">best</span><span class="o">=</span><span class="n">best_values_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">worst</span><span class="o">=</span><span class="n">worst_values_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference_point</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">FixedReferenceValue</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">objective</span><span class="p">,</span> <span class="p">(</span><span class="n">MinimizeObjective</span><span class="p">,</span> <span class="n">CloseToTargetObjective</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">else</span> <span class="n">reference_point</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_reference_value</span><span class="p">(</span>
                <span class="n">best</span><span class="o">=</span><span class="n">best_values_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">worst</span><span class="o">=</span><span class="n">worst_values_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_ref_point_mask</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>

    <span class="c1"># here we unmask again by dividing by the mask</span>
    <span class="k">if</span> <span class="n">return_masked</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">ref_point_array</span> <span class="o">/=</span> <span class="n">mask</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">feat</span><span class="p">:</span> <span class="n">ref_point_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">)}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="bofire.utils.naming_conventions" class="doc doc-heading">
            <code>naming_conventions</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="bofire.utils.naming_conventions.get_column_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_column_names</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Specifies column names for given Outputs type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>outputs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Outputs (bofire.data_models.domain.api.Outputs)" href="../ref-domain/#bofire.data_models.domain.features.Outputs">Outputs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Outputs object containing the individual outputs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="str">str</span>], <span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[str], List[str]]: A tuple containing the prediction column names and the standard deviation column names</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/naming_conventions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_column_names</span><span class="p">(</span><span class="n">outputs</span><span class="p">:</span> <span class="n">Outputs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Specifies column names for given Outputs type.</span>

<span class="sd">    Args:</span>
<span class="sd">        outputs (Outputs): The Outputs object containing the individual outputs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[str], List[str]]: A tuple containing the prediction column names and the standard deviation column names</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pred_cols</span><span class="p">,</span> <span class="n">sd_cols</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">featkey</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(</span><span class="n">CategoricalOutput</span><span class="p">):</span>
        <span class="n">pred_cols</span> <span class="o">=</span> <span class="n">pred_cols</span> <span class="o">+</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">featkey</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cat</span><span class="si">}</span><span class="s2">_prob&quot;</span>
            <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">featkey</span><span class="p">)</span><span class="o">.</span><span class="n">categories</span>  <span class="c1"># type: ignore</span>
        <span class="p">]</span>
        <span class="n">sd_cols</span> <span class="o">=</span> <span class="n">sd_cols</span> <span class="o">+</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">featkey</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cat</span><span class="si">}</span><span class="s2">_sd&quot;</span>
            <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">featkey</span><span class="p">)</span><span class="o">.</span><span class="n">categories</span>  <span class="c1"># type: ignore</span>
        <span class="p">]</span>
    <span class="k">for</span> <span class="n">featkey</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(</span><span class="n">ContinuousOutput</span><span class="p">):</span>
        <span class="n">pred_cols</span> <span class="o">=</span> <span class="n">pred_cols</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">featkey</span><span class="si">}</span><span class="s2">_pred&quot;</span><span class="p">]</span>
        <span class="n">sd_cols</span> <span class="o">=</span> <span class="n">sd_cols</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">featkey</span><span class="si">}</span><span class="s2">_sd&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">pred_cols</span><span class="p">,</span> <span class="n">sd_cols</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.naming_conventions.postprocess_categorical_predictions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">postprocess_categorical_predictions</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Postprocess categorical predictions by finding the maximum probability location</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predictions</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataframe containing the predictions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>outputs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Outputs (bofire.data_models.domain.api.Outputs)" href="../ref-domain/#bofire.data_models.domain.features.Outputs">Outputs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Outputs object containing the individual outputs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>predictions</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The (potentially modified) original dataframe with categorical predictions added</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/naming_conventions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">postprocess_categorical_predictions</span><span class="p">(</span>
    <span class="n">predictions</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="n">Outputs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Postprocess categorical predictions by finding the maximum probability location</span>

<span class="sd">    Args:</span>
<span class="sd">        predictions (pd.DataFrame): The dataframe containing the predictions.</span>
<span class="sd">        outputs (Outputs): The Outputs object containing the individual outputs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        predictions (pd.DataFrame): The (potentially modified) original dataframe with categorical predictions added</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">CategoricalOutput</span><span class="p">):</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">column</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_pred&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">predictions</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">(.*)_prob&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_prob&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">values</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">column</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_sd&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">predictions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="bofire.utils.reduce" class="doc doc-heading">
            <code>reduce</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="bofire.utils.reduce.AffineTransform" class="doc doc-heading">
            <code>AffineTransform</code>


</h3>


    <div class="doc doc-contents ">


        <p>Class to switch back and forth from the reduced to the original domain.</p>







              <details class="quote">
                <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AffineTransform</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to switch back and forth from the reduced to the original domain.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">equalities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes a `AffineTransformation` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            equalities (List[Tuple[str,List[str],List[float]]]): List of equalities. Every equality</span>
<span class="sd">                is defined as a tuple, in which the first entry is the key of the reduced feature, the second</span>
<span class="sd">                one is a list of feature keys that can be used to compute the feature and the third list of floats</span>
<span class="sd">                are the corresponding coefficients.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equalities</span> <span class="o">=</span> <span class="n">equalities</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">augment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore the eliminated features in a dataframe</span>

<span class="sd">        Args:</span>
<span class="sd">            data (pd.DataFrame): Dataframe that should be restored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Restored dataframe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equalities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name_lhs</span><span class="p">,</span> <span class="n">names_rhs</span><span class="p">,</span> <span class="n">coeffs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">equalities</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">name_lhs</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names_rhs</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">name_lhs</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop eliminated features from a dataframe.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (pd.DataFrame): Dataframe with features to be dropped.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Reduced dataframe.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equalities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="n">drop</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name_lhs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">equalities</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name_lhs</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_lhs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="bofire.utils.reduce.AffineTransform.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">equalities</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initializes a <code>AffineTransformation</code> object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>equalities</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="str">str</span>], <span title="typing.List">List</span>[<span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of equalities. Every equality
is defined as a tuple, in which the first entry is the key of the reduced feature, the second
one is a list of feature keys that can be used to compute the feature and the third list of floats
are the corresponding coefficients.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">equalities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes a `AffineTransformation` object.</span>

<span class="sd">    Args:</span>
<span class="sd">        equalities (List[Tuple[str,List[str],List[float]]]): List of equalities. Every equality</span>
<span class="sd">            is defined as a tuple, in which the first entry is the key of the reduced feature, the second</span>
<span class="sd">            one is a list of feature keys that can be used to compute the feature and the third list of floats</span>
<span class="sd">            are the corresponding coefficients.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">equalities</span> <span class="o">=</span> <span class="n">equalities</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bofire.utils.reduce.AffineTransform.augment_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">augment_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Restore the eliminated features in a dataframe</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe that should be restored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Restored dataframe</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">augment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Restore the eliminated features in a dataframe</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.DataFrame): Dataframe that should be restored.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Restored dataframe</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equalities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name_lhs</span><span class="p">,</span> <span class="n">names_rhs</span><span class="p">,</span> <span class="n">coeffs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">equalities</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">name_lhs</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names_rhs</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">name_lhs</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="bofire.utils.reduce.AffineTransform.drop_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Drop eliminated features from a dataframe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe with features to be dropped.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Reduced dataframe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Drop eliminated features from a dataframe.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.DataFrame): Dataframe with features to be dropped.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Reduced dataframe.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equalities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="n">drop</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name_lhs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">equalities</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name_lhs</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_lhs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="bofire.utils.reduce.adjust_boundary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">adjust_boundary</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adjusts the boundaries of a feature.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>feature</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ContinuousInput (bofire.data_models.features.api.ContinuousInput)" href="../ref-features/#bofire.data_models.features.continuous.ContinuousInput">ContinuousInput</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature to be adjusted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coef</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coefficient.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rhs</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right-hand-side of the constraint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">adjust_boundary</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n">ContinuousInput</span><span class="p">,</span> <span class="n">coef</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjusts the boundaries of a feature.</span>

<span class="sd">    Args:</span>
<span class="sd">        feature (ContinuousInput): Feature to be adjusted.</span>
<span class="sd">        coef (float): Coefficient.</span>
<span class="sd">        rhs (float): Right-hand-side of the constraint.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">boundary</span> <span class="o">=</span> <span class="n">rhs</span> <span class="o">/</span> <span class="n">coef</span>
    <span class="k">if</span> <span class="n">coef</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">boundary</span> <span class="o">&gt;</span> <span class="n">feature</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">:</span>
            <span class="n">feature</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">boundary</span><span class="p">,</span> <span class="n">feature</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">boundary</span> <span class="o">&lt;</span> <span class="n">feature</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">:</span>
        <span class="n">feature</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">boundary</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.reduce.check_domain_for_reduction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_domain_for_reduction</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if the reduction can be applied or if a trivial case is present.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain to be checked.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if reducable, else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_domain_for_reduction</span><span class="p">(</span><span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the reduction can be applied or if a trivial case is present.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Domain to be checked.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if reducable, else False.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># are there any constraints?</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># are there any linear equality constraints?</span>
    <span class="n">linear_equalities</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LinearEqualityConstraint</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_equalities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># are there no NChooseKConstraint constraints?</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">NChooseKConstraint</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># are there continuous inputs</span>
    <span class="n">continuous_inputs</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">continuous_inputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># check that equality constraints only contain continuous inputs</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">linear_equalities</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">LinearConstraint</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">feat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.reduce.check_existence_of_solution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_existence_of_solution</span><span class="p">(</span><span class="n">A_aug</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Given an augmented coefficient matrix this function determines the existence (and uniqueness) of solution using the rank theorem.</p>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_existence_of_solution</span><span class="p">(</span><span class="n">A_aug</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given an augmented coefficient matrix this function determines the existence (and uniqueness) of solution using the rank theorem.&quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">A_aug</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">A_aug</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">len_inputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">A</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># catch special cases</span>
    <span class="n">rk_A_aug</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">A_aug</span><span class="p">)</span>
    <span class="n">rk_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rk_A</span> <span class="o">==</span> <span class="n">rk_A_aug</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rk_A</span> <span class="o">&lt;</span> <span class="n">len_inputs</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># all good</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;There is a unique solution x for the linear equality constraints: x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">rk_A</span> <span class="o">&lt;</span> <span class="n">rk_A_aug</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;There is no solution fulfilling the linear equality constraints.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.reduce.reduce_domain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reduce_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reduce a domain with linear equality constraints to a subdomain where linear equality constraints are eliminated.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain to be reduced.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a>, <a class="autorefs autorefs-internal" title="AffineTransform (bofire.utils.reduce.AffineTransform)" href="#bofire.utils.reduce.AffineTransform">AffineTransform</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[Domain, AffineTransform]: reduced domain and the according transformation to switch between the
reduced and original domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reduce_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Domain</span><span class="p">,</span> <span class="n">AffineTransform</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce a domain with linear equality constraints to a subdomain where linear equality constraints are eliminated.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Domain to be reduced.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[Domain, AffineTransform]: reduced domain and the according transformation to switch between the</span>
<span class="sd">            reduced and original domain.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if the domain can be reduced</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_domain_for_reduction</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">domain</span><span class="p">,</span> <span class="n">AffineTransform</span><span class="p">([])</span>

    <span class="c1"># find linear equality constraints</span>
    <span class="n">linear_equalities</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">LinearEqualityConstraint</span><span class="p">)</span>
    <span class="n">other_constraints</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">Constraint</span><span class="p">,</span>
        <span class="n">excludes</span><span class="o">=</span><span class="p">[</span><span class="n">LinearEqualityConstraint</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># only consider continuous inputs</span>
    <span class="n">continuous_inputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">cast</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">other_inputs</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Input</span><span class="p">,</span> <span class="n">excludes</span><span class="o">=</span><span class="p">[</span><span class="n">ContinuousInput</span><span class="p">])</span>

    <span class="c1"># assemble Matrix A from equality constraints</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_equalities</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">continuous_inputs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="n">feat</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">continuous_inputs</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;rhs&quot;</span><span class="p">]))</span>

    <span class="n">A_aug</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linear_equalities</span><span class="p">)):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">linear_equalities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">LinearEqualityConstraint</span><span class="p">)</span>
        <span class="n">A_aug</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">coefficients</span>
        <span class="n">A_aug</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;rhs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">rhs</span>
    <span class="n">A_aug</span> <span class="o">=</span> <span class="n">A_aug</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># catch special cases</span>
    <span class="n">check_existence_of_solution</span><span class="p">(</span><span class="n">A_aug</span><span class="p">)</span>

    <span class="c1"># bring A_aug to reduced row-echelon form</span>
    <span class="n">A_aug_rref</span><span class="p">,</span> <span class="n">pivots</span> <span class="o">=</span> <span class="n">rref</span><span class="p">(</span><span class="n">A_aug</span><span class="p">)</span>
    <span class="n">pivots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pivots</span><span class="p">)</span>
    <span class="n">A_aug_rref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A_aug_rref</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="c1"># formulate box bounds as linear inequality constraints in matrix form</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">M</span><span class="p">))</span>
    <span class="n">B</span><span class="p">[:</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">B</span><span class="p">[</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:,</span> <span class="p">:</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">B</span><span class="p">[:</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">feat</span><span class="o">.</span><span class="n">upper_bound</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">continuous_inputs</span><span class="p">])</span>
    <span class="n">B</span><span class="p">[</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">feat</span><span class="o">.</span><span class="n">lower_bound</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">continuous_inputs</span><span class="p">])</span>

    <span class="c1"># eliminate columns with pivot element</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pivots</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pivots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">B</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-=</span> <span class="n">A_aug_rref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">B</span><span class="p">[</span><span class="n">p</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="n">A_aug_rref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># build up reduced domain</span>
    <span class="n">_domain</span> <span class="o">=</span> <span class="n">Domain</span><span class="o">.</span><span class="n">model_construct</span><span class="p">(</span>
        <span class="c1"># _fields_set = {&quot;inputs&quot;, &quot;outputs&quot;, &quot;constraints&quot;}</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other_inputs</span><span class="p">),</span>
        <span class="n">outputs</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="p">),</span>
        <span class="n">constraints</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other_constraints</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">new_inputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">deepcopy</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">continuous_inputs</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pivots</span>
    <span class="p">]</span>
    <span class="n">all_inputs</span> <span class="o">=</span> <span class="n">_domain</span><span class="o">.</span><span class="n">inputs</span> <span class="o">+</span> <span class="n">new_inputs</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">all_inputs</span><span class="p">,</span> <span class="n">Inputs</span><span class="p">)</span>
    <span class="n">_domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">all_inputs</span><span class="o">.</span><span class="n">features</span>

    <span class="n">constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AnyConstraint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pivots</span><span class="p">:</span>
        <span class="c1"># reduce equation system of upper bounds</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">LinearInequalityConstraint</span><span class="o">.</span><span class="n">from_greater_equal</span><span class="p">(</span>
                    <span class="n">features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
                    <span class="n">coefficients</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ind</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                    <span class="n">rhs</span><span class="o">=</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">,</span> <span class="n">_domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                <span class="n">adjust_boundary</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ind</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e-16</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;There is no solution that fulfills the constraints.&quot;</span><span class="p">)</span>

        <span class="c1"># reduce equation system of lower bounds</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">LinearInequalityConstraint</span><span class="o">.</span><span class="n">from_greater_equal</span><span class="p">(</span>
                    <span class="n">features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
                    <span class="n">coefficients</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                    <span class="n">rhs</span><span class="o">=</span><span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">,</span> <span class="n">_domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                <span class="n">adjust_boundary</span><span class="p">(</span>
                    <span class="n">feat</span><span class="p">,</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e-16</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;There is no solution that fulfills the constraints.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="n">_domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">constraints</span> <span class="o">+</span> <span class="n">constraints</span>  <span class="c1"># type: ignore</span>

    <span class="c1"># assemble equalities</span>
    <span class="n">_equalities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pivots</span><span class="p">)):</span>
        <span class="n">name_lhs</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">pivots</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">names_rhs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">A_aug_rref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">pivots</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">A_aug_rref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">names_rhs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">A_aug_rref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">_equalities</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name_lhs</span><span class="p">,</span> <span class="n">names_rhs</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">))</span>

    <span class="n">trafo</span> <span class="o">=</span> <span class="n">AffineTransform</span><span class="p">(</span><span class="n">_equalities</span><span class="p">)</span>
    <span class="c1"># remove remaining dependencies of eliminated inputs from the problem</span>
    <span class="n">_domain</span> <span class="o">=</span> <span class="n">remove_eliminated_inputs</span><span class="p">(</span><span class="n">_domain</span><span class="p">,</span> <span class="n">trafo</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_domain</span><span class="p">,</span> <span class="n">trafo</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.reduce.remove_eliminated_inputs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_eliminated_inputs</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Eliminates remaining occurrences of eliminated inputs in linear constraints.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain in which the linear constraints should be purged.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffineTransform (bofire.utils.reduce.AffineTransform)" href="#bofire.utils.reduce.AffineTransform">AffineTransform</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Affine transformation object that defines the obsolete features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If feature occurs in a constraint different from a linear one.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Domain</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Purged domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_eliminated_inputs</span><span class="p">(</span><span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">transform</span><span class="p">:</span> <span class="n">AffineTransform</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Domain</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Eliminates remaining occurrences of eliminated inputs in linear constraints.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Domain in which the linear constraints should be purged.</span>
<span class="sd">        transform (AffineTransform): Affine transformation object that defines the obsolete features.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If feature occurs in a constraint different from a linear one.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Domain: Purged domain.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inputs_names</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs_names</span><span class="p">)</span>

    <span class="c1"># write the equalities for the backtransformation into one matrix</span>
    <span class="n">inputs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">inputs_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)}</span>

    <span class="c1"># build up dict from domain.equalities e.g. {&quot;xi1&quot;: [coeff(xj1), ..., coeff(xjn)], ... &quot;xik&quot;:...}</span>
    <span class="n">coeffs_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">transform</span><span class="o">.</span><span class="n">equalities</span><span class="p">:</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">coeffs</span><span class="p">[</span><span class="n">inputs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="n">coeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">coeffs_dict</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">coeffs</span>

    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="c1"># Nonlinear constraints not supported</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">LinearConstraint</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Elimination of variables is only supported for LinearEquality and LinearInequality constraints.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># no changes, if the constraint does not contain eliminated inputs</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">inputs_names</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="c1"># remove inputs from the constraint that were eliminated from the inputs before</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">totally_removed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">inputs_names</span><span class="p">)</span>
            <span class="n">_rhs</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">rhs</span>

            <span class="c1"># create new lhs and rhs from the old one and knowledge from problem._equalities</span>
            <span class="n">_coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">inputs_names</span><span class="p">:</span>
                    <span class="n">_coefficients</span><span class="p">[</span><span class="n">inputs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">c</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_coefficients</span> <span class="o">+=</span> <span class="n">c</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeffs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">_rhs</span> <span class="o">-=</span> <span class="n">c</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeffs_dict</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">_features</span> <span class="o">=</span> <span class="n">_features</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_coefficients</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-16</span><span class="p">]</span>
            <span class="n">_coefficients</span> <span class="o">=</span> <span class="n">_coefficients</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_coefficients</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-16</span><span class="p">]</span>
            <span class="n">_c</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">LinearEqualityConstraint</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_c</span> <span class="o">=</span> <span class="n">LinearEqualityConstraint</span><span class="p">(</span>
                        <span class="n">features</span><span class="o">=</span><span class="n">_features</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">coefficients</span><span class="o">=</span><span class="n">_coefficients</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">rhs</span><span class="o">=</span><span class="n">_rhs</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">totally_removed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">feat</span><span class="p">:</span> <span class="n">ContinuousInput</span> <span class="o">=</span> <span class="n">ContinuousInput</span><span class="p">(</span>
                        <span class="o">**</span><span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">_features</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="n">feat</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">totally_removed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">_c</span> <span class="o">=</span> <span class="n">LinearInequalityConstraint</span><span class="p">(</span>
                    <span class="n">features</span><span class="o">=</span><span class="n">_features</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                    <span class="n">coefficients</span><span class="o">=</span><span class="n">_coefficients</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                    <span class="n">rhs</span><span class="o">=</span><span class="n">_rhs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">totally_removed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">,</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">_features</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">adjust_boundary</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_rhs</span><span class="p">)</span>
                <span class="n">totally_removed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># check if constraint is always fulfilled/not fulfilled</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">totally_removed</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">_c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_c</span><span class="o">.</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">_c</span><span class="o">.</span><span class="n">rhs</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_c</span><span class="o">.</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">_c</span><span class="o">.</span><span class="n">rhs</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Linear constraints cannot be fulfilled.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">_c</span><span class="o">.</span><span class="n">rhs</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_c</span><span class="p">)</span>
    <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="n">Constraints</span><span class="p">(</span><span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">domain</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.reduce.rref" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rref</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the reduced row echelon form of a Matrix</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>A</code>
            </td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2d array representing a matrix.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tol</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tolerance for rounding to 0. Defaults to 1e-8.</p>
              </div>
            </td>
            <td>
                  <code>1e-08</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(A_rref, pivots), where A_rref is the reduced row echelon form of A and pivots</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>is a numpy array containing the pivot columns of A_rref</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/reduce.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rref</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the reduced row echelon form of a Matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        A (ndarray): 2d array representing a matrix.</span>
<span class="sd">        tol (float, optional): tolerance for rounding to 0. Defaults to 1e-8.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (A_rref, pivots), where A_rref is the reduced row echelon form of A and pivots</span>
<span class="sd">        is a numpy array containing the pivot columns of A_rref</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

    <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pivots</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="c1"># does a pivot element exist?</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">row</span><span class="p">:,</span> <span class="n">col</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="c1"># if yes: start elimination</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pivots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">max_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">row</span><span class="p">:,</span> <span class="n">col</span><span class="p">]))</span> <span class="o">+</span> <span class="n">row</span>
            <span class="c1"># switch to most stable row</span>
            <span class="n">A</span><span class="p">[[</span><span class="n">row</span><span class="p">,</span> <span class="n">max_row</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[[</span><span class="n">max_row</span><span class="p">,</span> <span class="n">row</span><span class="p">],</span> <span class="p">:]</span>
            <span class="c1"># normalize row</span>
            <span class="n">A</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/=</span> <span class="n">A</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
            <span class="c1"># eliminate other elements from column</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="n">row</span><span class="p">:</span>
                    <span class="n">A</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-=</span> <span class="n">A</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">/</span> <span class="n">A</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">prec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tol</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">prec</span><span class="p">),</span> <span class="n">pivots</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="bofire.utils.subdomain" class="doc doc-heading">
            <code>subdomain</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="bofire.utils.subdomain.get_subdomain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_subdomain</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">feature_keys</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Removes all features not defined as argument creating a subdomain of the provided domain</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.domain.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the original domain wherefrom a subdomain should be created</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_keys</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of features that shall be included in the subdomain</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Assert">Assert</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>when in total less than 2 features are provided</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>when a provided feature key is not present in the provided domain</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Assert">Assert</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>when no output feature is provided</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Assert">Assert</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>when no input feature is provided</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Domain</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.domain.domain.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new domain containing only parts of the original domain</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/subdomain.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_subdomain</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
    <span class="n">feature_keys</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Domain</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes all features not defined as argument creating a subdomain of the provided domain</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): the original domain wherefrom a subdomain should be created</span>
<span class="sd">        feature_keys (List): List of features that shall be included in the subdomain</span>

<span class="sd">    Raises:</span>
<span class="sd">        Assert: when in total less than 2 features are provided</span>
<span class="sd">        ValueError: when a provided feature key is not present in the provided domain</span>
<span class="sd">        Assert: when no output feature is provided</span>
<span class="sd">        Assert: when no input feature is provided</span>
<span class="sd">        ValueError: _description_</span>

<span class="sd">    Returns:</span>
<span class="sd">        Domain: A new domain containing only parts of the original domain</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_keys</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;At least two features have to be provided.&quot;</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">feature_keys</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">inputs</span> <span class="o">+</span> <span class="n">domain</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not present in domain.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">Input</span><span class="p">):</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;At least one output feature has to be provided.&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;At least one input feature has to be provided.&quot;</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">Inputs</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">Outputs</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
    <span class="c1"># loop over constraints and make sure that all features used in constraints are in the input_feature_keys</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Removed input feature </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is used in a constraint.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
    <span class="n">subdomain</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
    <span class="n">subdomain</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="n">subdomain</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
    <span class="k">return</span> <span class="n">subdomain</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="bofire.utils.torch_tools" class="doc doc-heading">
            <code>torch_tools</code>


</h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="bofire.utils.torch_tools.InterpolateTransform" class="doc doc-heading">
            <code>InterpolateTransform</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="botorch.models.transforms.input.InputTransform">InputTransform</span></code>, <code><span title="torch.nn.Module">Module</span></code></p>


        <p>Botorch input transform that interpolates values between given x and y values.</p>







              <details class="quote">
                <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">InterpolateTransform</span><span class="p">(</span><span class="n">InputTransform</span><span class="p">,</span> <span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Botorch input transform that interpolates values between given x and y values.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">new_x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">idx_x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">idx_y</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">prepend_x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">prepend_y</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">append_x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">append_y</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">keep_original</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">transform_on_train</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">transform_on_eval</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">transform_on_fantasize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idx_x</span> <span class="o">+</span> <span class="n">idx_y</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Indices are not unique.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">idx_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">idx_x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">idx_y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transform_on_train</span> <span class="o">=</span> <span class="n">transform_on_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_on_eval</span> <span class="o">=</span> <span class="n">transform_on_eval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_on_fantasize</span> <span class="o">=</span> <span class="n">transform_on_fantasize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_x</span> <span class="o">=</span> <span class="n">new_x</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prepend_x</span> <span class="o">=</span> <span class="n">prepend_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepend_y</span> <span class="o">=</span> <span class="n">prepend_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_x</span> <span class="o">=</span> <span class="n">append_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_y</span> <span class="o">=</span> <span class="n">append_y</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">keep_original</span> <span class="o">=</span> <span class="n">keep_original</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepend_x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">append_x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idx_y</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepend_y</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">append_y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of x and y indices must be equal.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficient</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">values_reshaped</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">values_expanded</span> <span class="o">=</span> <span class="n">values_reshaped</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">values_expanded</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">values_reshaped</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">values_expanded</span> <span class="o">=</span> <span class="n">values_reshaped</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">values_expanded</span><span class="p">,</span> <span class="n">X</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">):</span>
        <span class="n">shapeX</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_x</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepend_x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_x</span><span class="p">)</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_y</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepend_y</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">shapeX</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">shapeX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">shapeX</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">shapeX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">new_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_x</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">interp1d</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">new_x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">new_y</span> <span class="o">=</span> <span class="n">new_y</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">shapeX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shapeX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_original</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">new_y</span><span class="p">,</span> <span class="n">X</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_y</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.constrained_objective2botorch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">constrained_objective2botorch</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">x_adapt</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a callable that can be used by <code>botorch.utils.objective.apply_constraints</code>
to setup output constrained optimizations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the constraint objective in the list of outputs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>objective</code>
            </td>
            <td>
                  <code><span title="BotorchConstrainedObjective">BotorchConstrainedObjective</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The objective that should be transformed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_adapt</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tensor that should be used to adapt the objective,
for example in case of a moving turning point in the <code>MovingMaximizeSigmoidObjective</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Small value to avoid numerical instabilities in case of the <code>ConstrainedCategoricalObjective</code>.
Defaults to 1e-8.</p>
              </div>
            </td>
            <td>
                  <code>1e-08</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>], <span title="torch.Tensor">Tensor</span>]], <span title="typing.List">List</span>[<span title="float">float</span>], <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[Callable[[Tensor], Tensor]], List[float], int]: List of callables that can be used by botorch for setting up the constrained objective,
list of the corresponding botorch eta values, final index used by the method (to track for categorical variables)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">constrained_objective2botorch</span><span class="p">(</span>
    <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">objective</span><span class="p">:</span> <span class="n">ConstrainedObjective</span><span class="p">,</span>
    <span class="n">x_adapt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a callable that can be used by `botorch.utils.objective.apply_constraints`</span>
<span class="sd">    to setup output constrained optimizations.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx (int): Index of the constraint objective in the list of outputs.</span>
<span class="sd">        objective (BotorchConstrainedObjective): The objective that should be transformed.</span>
<span class="sd">        x_adapt (Optional[Tensor]): The tensor that should be used to adapt the objective,</span>
<span class="sd">            for example in case of a moving turning point in the `MovingMaximizeSigmoidObjective`.</span>
<span class="sd">        eps (float, optional): Small value to avoid numerical instabilities in case of the `ConstrainedCategoricalObjective`.</span>
<span class="sd">            Defaults to 1e-8.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[Callable[[Tensor], Tensor]], List[float], int]: List of callables that can be used by botorch for setting up the constrained objective,</span>
<span class="sd">            list of the corresponding botorch eta values, final index used by the method (to track for categorical variables)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">objective</span><span class="p">,</span>
        <span class="n">ConstrainedObjective</span><span class="p">,</span>
    <span class="p">),</span> <span class="s2">&quot;Objective is not a `ConstrainedObjective`.&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">MaximizeSigmoidObjective</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="k">lambda</span> <span class="n">Z</span><span class="p">:</span> <span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">objective</span><span class="o">.</span><span class="n">tp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">objective</span><span class="o">.</span><span class="n">steepness</span><span class="p">],</span>
            <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">MovingMaximizeSigmoidObjective</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">x_adapt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">x_adapt</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">+</span> <span class="n">objective</span><span class="o">.</span><span class="n">tp</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="k">lambda</span> <span class="n">Z</span><span class="p">:</span> <span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">tp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">objective</span><span class="o">.</span><span class="n">steepness</span><span class="p">],</span>
            <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">MinimizeSigmoidObjective</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="k">lambda</span> <span class="n">Z</span><span class="p">:</span> <span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">objective</span><span class="o">.</span><span class="n">tp</span><span class="p">)],</span>
            <span class="p">[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">objective</span><span class="o">.</span><span class="n">steepness</span><span class="p">],</span>
            <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">TargetObjective</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span>
                <span class="k">lambda</span> <span class="n">Z</span><span class="p">:</span> <span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">target_value</span> <span class="o">-</span> <span class="n">objective</span><span class="o">.</span><span class="n">tolerance</span><span class="p">))</span>
                <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">Z</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">Z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">target_value</span> <span class="o">+</span> <span class="n">objective</span><span class="o">.</span><span class="n">tolerance</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">objective</span><span class="o">.</span><span class="n">steepness</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">objective</span><span class="o">.</span><span class="n">steepness</span><span class="p">],</span>
            <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">ConstrainedCategoricalObjective</span><span class="p">):</span>
        <span class="c1"># The output of a categorical objective has final dim `c` where `c` is number of classes</span>
        <span class="c1"># Pass in the expected acceptance probability and perform an inverse sigmoid to attain the original probabilities</span>
        <span class="c1"># as Botorch does sigmoid transformation for the constraint by default, therefore we need to unsigmoid the probability</span>
        <span class="c1"># (0-1) to (-inf,inf) also we need to invert the probability, where -inf means the constraint is satisfied.</span>
        <span class="c1"># Finally, we add some slack (`eps`) 1e-8 to avoid log(0). Have also a look at this botorch community notebook</span>
        <span class="c1"># https://github.com/pytorch/botorch/blob/main/notebooks_community/clf_constrained_bo.ipynb and this botorch issue</span>
        <span class="c1"># https://github.com/pytorch/botorch/issues/725 which is inspired by this implementation.</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span>
                <span class="k">lambda</span> <span class="n">Z</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="mi">1</span>
                    <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">Z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">idx</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">desirability</span><span class="p">)]</span>
                            <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">desirability</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                        <span class="nb">min</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
                        <span class="nb">max</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="n">idx</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">desirability</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objective </span><span class="si">{</span><span class="n">objective</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> not known.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_initial_conditions_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_initial_conditions_generator</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">transform_specs</span><span class="p">,</span> <span class="n">ask_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sequential</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Takes a strategy object and returns a callable which uses this
strategy to return a generator callable which can be used in botorch<code>s</code>gen_batch_initial_conditions` to generate samples.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>strategy</code>
            </td>
            <td>
                  <code><span title="bofire.strategies.strategy.Strategy">Strategy</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strategy that should be used to generate samples.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform_specs</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary indicating how the samples should be
transformed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ask_options</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of keyword arguments that are
passed to the <code>ask</code> method of the strategy. Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sequential</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, samples for every q-batch are
generate independent from each other. If False, the <code>n x q</code> samples
are generated at once.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="int">int</span>, <span title="int">int</span>, <span title="int">int</span>], <span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable[[int, int, int], Tensor]: Callable that can be passed to
<code>batch_initial_conditions</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_initial_conditions_generator</span><span class="p">(</span>
    <span class="n">strategy</span><span class="p">:</span> <span class="n">Strategy</span><span class="p">,</span>
    <span class="n">transform_specs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">ask_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes a strategy object and returns a callable which uses this</span>
<span class="sd">    strategy to return a generator callable which can be used in botorch`s</span>
<span class="sd">    `gen_batch_initial_conditions` to generate samples.</span>

<span class="sd">    Args:</span>
<span class="sd">        strategy (Strategy): Strategy that should be used to generate samples.</span>
<span class="sd">        transform_specs (Dict): Dictionary indicating how the samples should be</span>
<span class="sd">            transformed.</span>
<span class="sd">        ask_options (Dict, optional): Dictionary of keyword arguments that are</span>
<span class="sd">            passed to the `ask` method of the strategy. Defaults to {}.</span>
<span class="sd">        sequential (bool, optional): If True, samples for every q-batch are</span>
<span class="sd">            generate independent from each other. If False, the `n x q` samples</span>
<span class="sd">            are generated at once.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Callable[[int, int, int], Tensor]: Callable that can be passed to</span>
<span class="sd">            `batch_initial_conditions`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ask_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ask_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generator</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sequential</span><span class="p">:</span>
            <span class="n">initial_conditions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">candidates</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">**</span><span class="n">ask_options</span><span class="p">)</span>
                <span class="c1"># transform it</span>
                <span class="n">transformed_candidates</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                    <span class="n">candidates</span><span class="p">,</span>
                    <span class="n">transform_specs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># transform to tensor</span>
                <span class="n">initial_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">transformed_candidates</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">initial_conditions</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="o">**</span><span class="n">ask_options</span><span class="p">)</span>
        <span class="c1"># transform it</span>
        <span class="n">transformed_candidates</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
            <span class="n">candidates</span><span class="p">,</span>
            <span class="n">transform_specs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">transformed_candidates</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">transformed_candidates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">generator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_interpoint_constraints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_interpoint_constraints</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">n_candidates</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Converts interpoint equality constraints to linear equality constraints,
    that can be processed by botorch. For more information, see the docstring
    of <code>optimize_acqf</code> in botorch
    (https://github.com/pytorch/botorch/blob/main/botorch/optim/optimize.py).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimization problem definition.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_candidates</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of candidates that should be requested.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Tuple[Tensor, Tensor, float]]: List of tuples, each tuple consists
of a tensor with the feature indices, coefficients and a float for the rhs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_interpoint_constraints</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
    <span class="n">n_candidates</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts interpoint equality constraints to linear equality constraints,</span>
<span class="sd">        that can be processed by botorch. For more information, see the docstring</span>
<span class="sd">        of `optimize_acqf` in botorch</span>
<span class="sd">        (https://github.com/pytorch/botorch/blob/main/botorch/optim/optimize.py).</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Optimization problem definition.</span>
<span class="sd">        n_candidates (int): Number of candidates that should be requested.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Tuple[Tensor, Tensor, float]]: List of tuples, each tuple consists</span>
<span class="sd">            of a tensor with the feature indices, coefficients and a float for the rhs.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">n_candidates</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">constraints</span>
    <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">InterpointEqualityConstraint</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">InterpointEqualityConstraint</span><span class="p">)</span>
        <span class="n">coefficients</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="n">feat_idx</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(</span><span class="n">Input</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">feature</span><span class="p">)</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">feature</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">ContinuousInput</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">feat</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">multiplicity</span> <span class="ow">or</span> <span class="n">n_candidates</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_candidates</span> <span class="o">/</span> <span class="n">multiplicity</span><span class="p">)):</span>
            <span class="n">all_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="n">i</span> <span class="o">*</span> <span class="n">multiplicity</span><span class="p">,</span>
                <span class="nb">min</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">n_candidates</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_indices</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">all_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">feat_idx</span><span class="p">],</span> <span class="p">[</span><span class="n">all_indices</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">feat_idx</span><span class="p">]],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">indices</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">constraints</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_linear_constraints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_linear_constraints</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">unit_scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Converts linear constraints to the form required by BoTorch. For inequality constraints, this is A * x &gt;= b (!).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimization problem definition.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constraint</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="LinearEqualityConstraint (bofire.data_models.constraints.api.LinearEqualityConstraint)" href="../ref-constraints/#bofire.data_models.constraints.linear.LinearEqualityConstraint">LinearEqualityConstraint</a>], <span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="LinearInequalityConstraint (bofire.data_models.constraints.api.LinearInequalityConstraint)" href="../ref-constraints/#bofire.data_models.constraints.linear.LinearInequalityConstraint">LinearInequalityConstraint</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of constraint that should be converted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unit_scaled</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, transforms constraints by assuming that the bound for the continuous features are [0,1]. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Tuple[Tensor, Tensor, float]]: List of tuples, each tuple consists of a tensor with the feature indices, coefficients and a float for the rhs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_linear_constraints</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
    <span class="n">constraint</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">LinearEqualityConstraint</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">LinearInequalityConstraint</span><span class="p">]],</span>
    <span class="n">unit_scaled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts linear constraints to the form required by BoTorch. For inequality constraints, this is A * x &gt;= b (!).</span>

<span class="sd">    Args:</span>
<span class="sd">        domain: Optimization problem definition.</span>
<span class="sd">        constraint: Type of constraint that should be converted.</span>
<span class="sd">        unit_scaled: If True, transforms constraints by assuming that the bound for the continuous features are [0,1]. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Tuple[Tensor, Tensor, float]]: List of tuples, each tuple consists of a tensor with the feature indices, coefficients and a float for the rhs.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">constraint</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coefficients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">featkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(</span><span class="n">Input</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">featkey</span><span class="p">)</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_by_key</span><span class="p">(</span><span class="n">featkey</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">feat</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">():</span>
                <span class="n">rhs</span> <span class="o">-=</span> <span class="n">feat</span><span class="o">.</span><span class="n">fixed_value</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="n">upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="n">coefficients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="p">)</span>  <span class="c1"># if unit_scaled == False else c_scaled.coefficients[i])</span>
        <span class="k">if</span> <span class="n">unit_scaled</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span>
            <span class="n">scaled_coefficients</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span>
                    <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">scaled_coefficients</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="n">rhs</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">rhs</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span> <span class="o">*</span> <span class="n">lower</span><span class="p">)),</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span>
                    <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="n">rhs</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">rhs</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">constraints</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_multiobjective_objective" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_multiobjective_objective</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">experiments</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a callable that can be used by botorch for multiobjective optimization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>outputs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Outputs (bofire.data_models.api.Outputs)" href="../ref-domain/#bofire.data_models.domain.features.Outputs">Outputs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outputs object for which the callable should be generated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>experiments</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing the experiments that are used for
adapting the objectives on the fly, for example in the case of the
<code>MovingMaximizeSigmoidObjective</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>, <span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]], <span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable[[Tensor], Tensor]: <em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_multiobjective_objective</span><span class="p">(</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="n">Outputs</span><span class="p">,</span>
    <span class="n">experiments</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]],</span> <span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a callable that can be used by botorch for multiobjective optimization.</span>

<span class="sd">    Args:</span>
<span class="sd">        outputs (Outputs): Outputs object for which the callable should be generated.</span>
<span class="sd">        experiments (pd.DataFrame): DataFrame containing the experiments that are used for</span>
<span class="sd">            adapting the objectives on the fly, for example in the case of the</span>
<span class="sd">            `MovingMaximizeSigmoidObjective`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Callable[[Tensor], Tensor]: _description_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">allowed_objectives</span> <span class="o">=</span> <span class="p">[</span><span class="n">MaximizeObjective</span><span class="p">,</span> <span class="n">MinimizeObjective</span><span class="p">,</span> <span class="n">CloseToTargetObjective</span><span class="p">]</span>

    <span class="n">callables_outputs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_callables_and_weights</span><span class="p">(</span>
        <span class="n">outputs</span><span class="p">,</span>
        <span class="n">experiments</span><span class="p">,</span>
        <span class="n">allowed_objectives</span><span class="o">=</span><span class="n">allowed_objectives</span><span class="p">,</span>
        <span class="n">adapt_weights_to_1_inf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">c</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">callables_outputs</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">objective</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_multiplicative_additive_objective" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_multiplicative_additive_objective</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">experiments</span><span class="p">,</span> <span class="n">exclude_constraints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additive_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adapt_weights_to_1_inf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the objective as a mix of multiplicative and additive objectives. By default, all objectives are multiplicative.
Additive features (inputs or outputs) can be specified in the <code>additive_features</code> list.</p>
<p>The formular for a mixed objective with two multiplicative features (f1, and f2 with weights w1 and w2) and two
additive features (f3 and f4 with weights w3 and w4) is:</p>
<div class="highlight"><pre><span></span><code>additive_objective = 1 + f3*w3 + f4*w4

objective = f1^w1 * f2^w2 * additive_objective
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>additive_features</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of features that should be treated as additive</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>adapt_weights_to_1_inf</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>will transform weights from [0,1] to [1,inf) space</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>objective</code></td>            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>callable that can be used by botorch for optimization</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_multiplicative_additive_objective</span><span class="p">(</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="n">Outputs</span><span class="p">,</span>
    <span class="n">experiments</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">exclude_constraints</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">additive_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">adapt_weights_to_1_inf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the objective as a mix of multiplicative and additive objectives. By default, all objectives are multiplicative.</span>
<span class="sd">    Additive features (inputs or outputs) can be specified in the `additive_features` list.</span>

<span class="sd">    The formular for a mixed objective with two multiplicative features (f1, and f2 with weights w1 and w2) and two</span>
<span class="sd">    additive features (f3 and f4 with weights w3 and w4) is:</span>

<span class="sd">        additive_objective = 1 + f3*w3 + f4*w4</span>

<span class="sd">        objective = f1^w1 * f2^w2 * additive_objective</span>


<span class="sd">    Args:</span>
<span class="sd">        outputs</span>
<span class="sd">        experiments</span>
<span class="sd">        exclude_constraints</span>
<span class="sd">        additive_features (List[str]): list of features that should be treated as additive</span>
<span class="sd">        adapt_weights_to_1_inf (bool): will transform weights from [0,1] to [1,inf) space</span>

<span class="sd">    Returns:</span>
<span class="sd">        objective (callable): callable that can be used by botorch for optimization</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">callables</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">_callables_and_weights</span><span class="p">(</span>
        <span class="n">outputs</span><span class="p">,</span>
        <span class="n">experiments</span><span class="p">,</span>
        <span class="n">exclude_constraints</span><span class="o">=</span><span class="n">exclude_constraints</span><span class="p">,</span>
        <span class="n">adapt_weights_to_1_inf</span><span class="o">=</span><span class="n">adapt_weights_to_1_inf</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">additive_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">additive_features</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_differ_additive_and_multiplicative_features</span><span class="p">(</span><span class="n">callables</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">):</span>
        <span class="n">callables_additive</span><span class="p">,</span> <span class="n">weights_additive</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">callables_multiplicative</span><span class="p">,</span> <span class="n">weights_multiplicative</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">callables</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">additive_features</span><span class="p">:</span>
                <span class="n">callables_additive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="n">weights_additive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">callables_multiplicative</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="n">weights_multiplicative</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">callables_additive</span><span class="p">,</span>
            <span class="n">weights_additive</span><span class="p">,</span>
            <span class="n">callables_multiplicative</span><span class="p">,</span>
            <span class="n">weights_multiplicative</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="p">(</span>
        <span class="n">callables_additive</span><span class="p">,</span>
        <span class="n">weights_additive</span><span class="p">,</span>
        <span class="n">callables_multiplicative</span><span class="p">,</span>
        <span class="n">weights_multiplicative</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">_differ_additive_and_multiplicative_features</span><span class="p">(</span><span class="n">callables</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
        <span class="n">additive_objective</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">callables_additive</span><span class="p">,</span> <span class="n">weights_additive</span><span class="p">):</span>
            <span class="n">additive_objective</span> <span class="o">=</span> <span class="n">additive_objective</span> <span class="o">+</span> <span class="n">c</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">*</span> <span class="n">w</span>

        <span class="n">multiplicative_objective</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">callables_multiplicative</span><span class="p">,</span> <span class="n">weights_multiplicative</span><span class="p">):</span>
            <span class="n">multiplicative_objective</span> <span class="o">=</span> <span class="n">multiplicative_objective</span> <span class="o">*</span> <span class="n">c</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">**</span> <span class="n">w</span>

        <span class="n">y</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">multiplicative_objective</span> <span class="o">*</span> <span class="n">additive_objective</span>
        <span class="k">return</span> <span class="n">y</span>

    <span class="k">return</span> <span class="n">objective</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_nchoosek_constraints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nchoosek_constraints</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transforms NChooseK constraints into a list of non-linear inequality constraint callables
that can be parsed by pydantic. For this purpose the NChooseK constraint is continuously
relaxed by countig the number of zeros in a candidate by a sum of narrow gaussians centered
at zero.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimization problem definition.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>], <span title="float">float</span>], <span title="bool">bool</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Callable[[Tensor], float]]: List of callables that can be used
as nonlinear equality constraints in botorch.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nchoosek_constraints</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms NChooseK constraints into a list of non-linear inequality constraint callables</span>
<span class="sd">    that can be parsed by pydantic. For this purpose the NChooseK constraint is continuously</span>
<span class="sd">    relaxed by countig the number of zeros in a candidate by a sum of narrow gaussians centered</span>
<span class="sd">    at zero.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Optimization problem definition.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Callable[[Tensor], float]]: List of callables that can be used</span>
<span class="sd">            as nonlinear equality constraints in botorch.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">narrow_gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ell</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">ell</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">max_constraint</span><span class="p">(</span><span class="n">indices</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">num_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">narrow_gaussian</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">indices</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
            <span class="n">num_features</span> <span class="o">-</span> <span class="n">max_count</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">min_constraint</span><span class="p">(</span><span class="n">indices</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">num_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">min_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">narrow_gaussian</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">indices</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">num_features</span> <span class="o">-</span> <span class="n">min_count</span>
        <span class="p">)</span>

    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># ignore none also valid for the start</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">NChooseKConstraint</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">NChooseKConstraint</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="p">[</span><span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">max_count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">max_constraint</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
                        <span class="n">num_features</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">),</span>
                        <span class="n">max_count</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">max_count</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">min_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">min_constraint</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
                        <span class="n">num_features</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">),</span>
                        <span class="n">min_count</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">min_count</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">constraints</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_nonlinear_constraints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nonlinear_constraints</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">includes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a list of callable functions that represent the nonlinear constraints
for the given domain that can be processed by botorch.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The domain for which to generate the nonlinear constraints.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>], <span title="float">float</span>], <span title="bool">bool</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Callable[[Tensor], float]]: A list of callable functions that take a tensor</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>], <span title="float">float</span>], <span title="bool">bool</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>as input and return a float value representing the constraint evaluation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nonlinear_constraints</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
    <span class="n">includes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Constraint</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of callable functions that represent the nonlinear constraints</span>
<span class="sd">    for the given domain that can be processed by botorch.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): The domain for which to generate the nonlinear constraints.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Callable[[Tensor], float]]: A list of callable functions that take a tensor</span>
<span class="sd">        as input and return a float value representing the constraint evaluation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">includes</span> <span class="o">=</span> <span class="n">includes</span> <span class="ow">or</span> <span class="p">[</span><span class="n">NChooseKConstraint</span><span class="p">,</span> <span class="n">ProductInequalityConstraint</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
        <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">NChooseKConstraint</span><span class="p">,</span> <span class="n">ProductInequalityConstraint</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">includes</span><span class="p">)</span>
    <span class="p">),</span> <span class="s2">&quot;Only NChooseK and ProductInequality constraints are supported.&quot;</span>

    <span class="n">callables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">NChooseKConstraint</span> <span class="ow">in</span> <span class="n">includes</span><span class="p">:</span>
        <span class="n">callables</span> <span class="o">+=</span> <span class="n">get_nchoosek_constraints</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ProductInequalityConstraint</span> <span class="ow">in</span> <span class="n">includes</span><span class="p">:</span>
        <span class="n">callables</span> <span class="o">+=</span> <span class="n">get_product_constraints</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">callables</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_output_constraints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_output_constraints</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">experiments</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Method to translate output constraint objectives into a list of
callables and list of etas for use in botorch.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>outputs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Outputs (bofire.data_models.api.Outputs)" href="../ref-domain/#bofire.data_models.domain.features.Outputs">Outputs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output feature object that should
be processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>experiments</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing the experiments that are used for
adapting the objectives on the fly, for example in the case of the
<code>MovingMaximizeSigmoidObjective</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>], <span title="torch.Tensor">Tensor</span>]], <span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[Callable[[Tensor], Tensor]], List[float]]: List of constraint callables,
list of associated etas.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_output_constraints</span><span class="p">(</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="n">Outputs</span><span class="p">,</span>
    <span class="n">experiments</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to translate output constraint objectives into a list of</span>
<span class="sd">    callables and list of etas for use in botorch.</span>

<span class="sd">    Args:</span>
<span class="sd">        outputs (Outputs): Output feature object that should</span>
<span class="sd">            be processed.</span>
<span class="sd">        experiments (pd.DataFrame): DataFrame containing the experiments that are used for</span>
<span class="sd">            adapting the objectives on the fly, for example in the case of the</span>
<span class="sd">            `MovingMaximizeSigmoidObjective`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[Callable[[Tensor], Tensor]], List[float]]: List of constraint callables,</span>
<span class="sd">            list of associated etas.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">etas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">objective</span><span class="p">,</span> <span class="n">ConstrainedObjective</span><span class="p">):</span>
            <span class="n">cleaned_experiments</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">preprocess_experiments_one_valid_output</span><span class="p">(</span>
                <span class="n">feat</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
                <span class="n">experiments</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">iconstraints</span><span class="p">,</span> <span class="n">ietas</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">constrained_objective2botorch</span><span class="p">(</span>
                <span class="n">idx</span><span class="p">,</span>
                <span class="n">objective</span><span class="o">=</span><span class="n">feat</span><span class="o">.</span><span class="n">objective</span><span class="p">,</span>
                <span class="n">x_adapt</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">cleaned_experiments</span><span class="p">[</span><span class="n">feat</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">tkwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">objective</span><span class="p">,</span> <span class="n">ConstrainedCategoricalObjective</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">constraints</span> <span class="o">+=</span> <span class="n">iconstraints</span>
            <span class="n">etas</span> <span class="o">+=</span> <span class="n">ietas</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">etas</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.get_product_constraints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_product_constraints</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a list of nonlinear constraint functions that can be processed by botorch
based on the given domain.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Domain (bofire.data_models.api.Domain)" href="../ref-domain/#bofire.data_models.domain.domain.Domain">Domain</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The domain object containing the constraints.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.Callable">Callable</span>[[<span title="torch.Tensor">Tensor</span>], <span title="float">float</span>], <span title="bool">bool</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Callable[[Tensor], float]]: A list of product constraint functions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_product_constraints</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Tensor</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of nonlinear constraint functions that can be processed by botorch</span>
<span class="sd">    based on the given domain.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): The domain object containing the constraints.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Callable[[Tensor], float]]: A list of product constraint functions.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">product_constraint</span><span class="p">(</span><span class="n">indices</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">exponents</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sign</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">sign</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">**</span> <span class="n">exponents</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">rhs</span>

    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ProductInequalityConstraint</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ProductInequalityConstraint</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="p">[</span><span class="n">domain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_keys</span><span class="p">(</span><span class="n">ContinuousInput</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">product_constraint</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">exponents</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">sign</span><span class="p">),</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">constraints</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bofire.utils.torch_tools.interp1d" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_new</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Interpolates values in the y tensor based on the x tensor using linear interpolation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x-coordinates of the data points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The y-coordinates of the data points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_new</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x-coordinates at which to interpolate the values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>torch.Tensor: The interpolated values at the x_new x-coordinates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bofire/utils/torch_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>  <span class="c1"># type: ignore</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interp1d</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">x_new</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpolates values in the y tensor based on the x tensor using linear interpolation.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (torch.Tensor): The x-coordinates of the data points.</span>
<span class="sd">        y (torch.Tensor): The y-coordinates of the data points.</span>
<span class="sd">        x_new (torch.Tensor): The x-coordinates at which to interpolate the values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        torch.Tensor: The interpolated values at the x_new x-coordinates.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ge</span><span class="p">(</span><span class="n">x_new</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">itp</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_new</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">itp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>